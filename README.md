ساختار پروژه پیام‌رسان (MySMS)
بررسی ساختار پروژه:
text
app/
├── manifests/
│   └── AndroidManifest.xml          # تنظیمات پرمیشن‌ها و کامپوننت‌های اپ
├── kotlin+java/
│   └── com.example.mysms/
│       ├── data/                    # لایه داده و دیتابیس
│       │   ├── AppDatabase.kt       # تنظیمات دیتابیس Room
│       │   ├── SmsDao.kt           # دسترسی‌های دیتابیس (DAO)
│       │   └── SmsEntity.kt        # مدل داده پیام
│       ├── repository/              # لایه مخزن داده
│       │   └── SmsRepository.kt    # مدیریت عملیات پیام‌ها
│       ├── ui.theme/               # لایه نمایش و UI
│       │   ├── ChatComponents.kt   # کامپوننت‌های قابل استفاده مجدد
│       │   ├── ChatScreen.kt       # صفحه گفتگو (نمایش پیام‌ها)
│       │   ├── Color.kt           # تعریف رنگ‌ها
│       │   ├── ConversationListScreen.kt  # لیست مکالمات
│       │   ├── InternalChatScreen.kt     # صفحه چت داخلی
│       │   ├── JalaliDateUtil.kt   # ابزار تاریخ شمسی
│       │   ├── InternalChatScreen.kt
│       │   ├── LoadingScreen.kt   # صفحه بارگذاری اولیه
│       │   ├── MainActivity.kt    # Activity اصلی و ناوبری
│       │   ├── SmsReceiver.kt     # دریافت‌کننده پیام‌های دریافتی
│       │   ├── Theme.kt          # تم اپلیکیشن
│       │   └── Type.kt           # تنظیمات تایپوگرافی
│       └── viewmodel/             # لایه منطق کسب‌وکار
│           └── HomeViewModel.kt   # مدیریت state و منطق اپلیکیشن
توضیحات هر فایل:
AndroidManifest.xml
کاربرد: فایل پیکربندی اصلی اندروید
وظایف:

تعریف پرمیشن‌های لازم (خواندن/نوشتن پیام، مخاطبین، وضعیت تلفن)

تعریف Activity اصلی و BroadcastReceiver برای دریافت پیام‌ها

تنظیمات اپلیکیشن (آیکون، تم، پشتیبانی از RTL)

AppDatabase.kt
کاربرد: تنظیمات دیتابیس Room
وظایف:

ایجاد singleton برای دسترسی به دیتابیس

تعریف نسخه و موجودیت‌های دیتابیس

پیکربندی migration و allowMainThreadQueries

SmsDao.kt
کاربرد: دسترسی به داده‌های پیام (Data Access Object)
وظایف:

Queryهای SQL برای عملیات CRUD روی پیام‌ها

دریافت پیام‌ها به صورت Flow برای مشاهده تغییرات

علامت‌گذاری پیام‌ها به عنوان خوانده شده

SmsEntity.kt
کاربرد: مدل داده پیام
وظایف:

تعریف ساختار پیام (آدرس، متن، تاریخ، نوع، وضعیت خواندن)

نگاشت به جدول دیتابیس با Room annotations

SmsRepository.kt
کاربرد: مخزن مرکزی برای عملیات پیام‌ها
وظایف:

همگام‌سازی پیام‌ها با SMS Provider سیستم

ارسال پیام جدید

دریافت نام مخاطبین از دفترچه تلفن

مدیریت شناسه سیم‌کارت‌ها

اجرای عملیات در background thread

HomeViewModel.kt
کاربرد: مدیریت state و منطق اپلیکیشن
وظایف:

نگهداری stateهای UI (لیست پیام‌ها، وضعیت بارگذاری)

مدیریت عملیات ارسال پیام

نگهداری پیش‌نویس‌ها

ارتباط بین Repository و UI

مدیریت lifecycle با Coroutines

MainActivity.kt
کاربرد: Activity اصلی و ناوبری اپ
وظایف:

مدیریت درخواست پرمیشن‌ها

کنترل ناوبری بین صفحات (بارگذاری، لیست مکالمات، چت)

تنظیم Tabهای سیم‌کارت‌ها

مقداردهی اولیه ViewModel

ChatScreen.kt
کاربرد: صفحه نمایش گفتگو با یک مخاطب
وظایف:

نمایش پیام‌ها به صورت حباب (ارسالی/دریافتی)

فیلد ورود پیام جدید

نمایش وضعیت ارسال (در حال ارسال، موفق، ناموفق)

پشتیبانی از پیام‌های موقت قبل از ذخیره در دیتابیس

ConversationListScreen.kt
کاربرد: صفحه لیست مکالمات
وظایف:

نمایش لیست مخاطبین با آخرین پیام

پشتیبانی از swipe برای pin کردن

نمایش تعداد پیام‌های خوانده نشده

جداسازی بر اساس سیم‌کارت

ChatComponents.kt
کاربرد: کامپوننت‌های UI قابل استفاده مجدد
وظایف:

کامپوننت ConversationItem: نمایش آیتم لیست مکالمات

کامپوننت SwipeToPinWithConfirm: قابلیت swipe با تایید

تابع getContactName: جستجوی نام مخاطب از دفترچه تلفن

InternalChatScreen.kt
کاربرد: صفحه چت پیشرفته با دسته‌بندی تاریخ
وظایف:

گروه‌بندی پیام‌ها بر اساس تاریخ شمسی

قابلیت expand/collapse برای هر روز

نمایش سرفصل تاریخ با تعداد پیام‌ها

LoadingScreen.kt
کاربرد: صفحه بارگذاری اولیه
وظایف:

نمایش پیشرفت همگام‌سازی پیام‌ها

درخواست پرمیشن‌ها

نمایش تب‌های سیم‌کارت‌ها

نمایش لیست اولیه پیام‌ها

SmsReceiver.kt
کاربرد: دریافت‌کننده پیام‌های دریافتی
وظایف:

دریافت پیام‌های جدید از سیستم

پردازش پیام‌ها در اندرویدهای قدیم و جدید

ذخیره پیام‌ها در دیتابیس

ارسال broadcast برای آپدیت UI

JalaliDateUtil.kt
کاربرد: ابزار تاریخ شمسی
وظایف:

تبدیل تاریخ میلادی به شمسی

نمایش تاریخ نسبی (امروز/دیروز/تاریخ)

فرمت‌بندی ساعت

Color.kt / Theme.kt / Type.kt
کاربرد: تنظیمات ظاهری اپلیکیشن
وظایف:

تعریف پالت رنگ‌ها

تنظیم تم Material Design 3

تعریف تایپوگرافی

نکات فنی:
Flow مدیریت داده:
SmsReceiver → پیام دریافت می‌شود

SmsRepository → ذخیره در دیتابیس

Room Database → Flow آپدیت می‌شود

HomeViewModel → مشاهده تغییرات

UI Screens → رندر مجدد

مدیریت Thread:
عملیات دیتابیس: Dispatchers.IO

عملیات UI: Dispatchers.Main

BroadcastReceiver: CoroutineScope(Dispatchers.IO)

ویژگی‌های کلیدی:
پشتیبانی از دو سیم‌کارت

تاریخ شمسی

دریافت خودکار پیام‌های جدید

قابلیت pin کردن مکالمات

پیش‌نویس ذخیره شده

جستجوی خودکار نام مخاطبین

پرمیشن‌های مورد نیاز:
READ_SMS / RECEIVE_SMS / SEND_SMS: مدیریت پیام‌ها

READ_CONTACTS: نمایش نام مخاطبین

READ_PHONE_STATE: تشخیص سیم‌کارت‌ها

POST_NOTIFICATIONS: نوتیفیکیشن (اندروید 13+)

تکنولوژی‌ها:
Jetpack Compose برای UI

Room برای دیتابیس

Coroutines برای async operations

Material Design 3

SMS Provider برای دسترسی به پیام‌های سیستم
